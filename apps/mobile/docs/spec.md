# 食欲の自己発見アプリ 仕様（MVP）

## 1. 目的
ユーザーが「特に食べたいものが決まっていない」状態でも、5択質問に答えることで
**今ほしい食の性質**を言語化し、結果として **外食ジャンル Top3** を提示する。
その後、各ジャンルで「近くの店を探す」導線を提供し、ユーザーが選択したジャンルを端末内で学習して精度を上げる。

本アプリは「当てる」よりも「気づかせる（自己発見）」を重視する。

## 2. 制約（超重要）
- バックエンド禁止（サーバ実装なし）
- 学習・ログ・データ保存は **端末内のみ**（SQLite推奨）
- 店検索はMVPでは **マップディープリンク**（APIキー不要）
- 位置情報は任意（拒否されても動作する）

## 3. 回答形式（5択固定）
回答ラベル（表示）
1. はい
2. たぶんはい
3. わからない
4. たぶんいいえ
5. いいえ

内部ID（例）: `YES, PROB_YES, UNKNOWN, PROB_NO, NO`

## 4. 出力（結果画面）
- Top3 ジャンル（名称 + 確率%）
- 各ジャンルの「それっぽい理由」1行（例：直近の回答から要約）
- 各ジャンルごとに：
  - 「近くで探す」ボタン（マップ起動）
  - 「これにする」ボタン（端末内学習に使用）

## 5. ジャンルの定義（スコープ）
- 対象は「外食で注文する単位」のジャンル（例：家系ラーメン、スパイスカレー、寿司、焼肉、麻婆豆腐…）
- 粒度が混ざるのを避ける：できるだけ“注文が想像できる”単位で統一
- MVP目標：ジャンル 150〜300件（最初は20〜50件でも可）

## 6. 質問の設計指針
- 「料理知識」より「身体感覚/気分」に寄せる（自己発見に効く）
- 1質問は短く、肯定形、答えやすい
- 1セッションで 7〜12問程度が気持ちよい
- 質問はグループ（例：temperature / richness / staple / spice_level…）に属し、同じグループが連発しないようにする

## 7. セッションの流れ
### 7.1 画面
- Home：開始ボタン
- Question：質問カード + 5択 + 進捗 + 戻る/中断
- Result：Top3 + 理由 + マップ起動 + 「これにする」
- Settings：学習リセット / データ初期化（任意）

### 7.2 終了条件（いずれか）
- 質問数が最大 `MAX_QUESTIONS(=12)` に到達
- Top1確信度が閾値 `CONFIDENCE_THRESHOLD(=0.65)` を超えた
- 候補ジャンルが少なすぎる（上位が固定化）と判断（任意：Top1-Top2差が十分大きい等）

## 8. 推論エンジン（端末内）
### 8.1 モデル
- `P(genre)`：ジャンル事前分布（初期は一様でOK）
- `P(answer | genre, question)`：ジャンル×質問に対する回答分布
- ベイズ更新のイメージ：回答が来るたびに `P(genre)` を更新
- 実装は安定のため **log空間**（logスコア）を推奨

### 8.2 初期値
- `stats(genre, question, answer)` をカウントとして持つ
- 初期は薄くても良い。スムージング（例：Dirichlet prior α=1）を必ず入れて極端化を避ける

### 8.3 次の質問選定
- 未出題の質問から、「今の候補分布を最も割る質問」を選ぶ
- MVPの近似：
  - 上位Kジャンル（例：30）に絞って計算
  - “期待エントロピー減少” が最大の質問を選ぶ
- 同一グループの連発を避ける（直近N=2で同グループを避ける、など）

### 8.4 理由生成（結果画面の1行理由）
- Topジャンルに対して「スコアへ寄与が大きかった回答」を2つ選び、
  それを自然文にする（例：「温かくてこってりが良い→家系ラーメンっぽい」）

## 9. 学習（端末内のみ）
- Resultでユーザーが「これにする」を押したジャンルを正解扱い
- セッション中の (question, answer) をそのジャンルに対して `stats + 1`
- 反映は次回セッションから
- 学習リセット：SQLiteのstatsを初期化（seedに戻す）

## 10. プライバシー
- 端末内保存のみ。外部送信なし。
- 位置情報はマップ起動にのみ使用（拒否時も動作する）
